# RAGåŠŸèƒ½æµ‹è¯•æŒ‡å—

## ðŸ“š RAGç³»ç»Ÿæž¶æž„

RAGï¼ˆæ£€ç´¢å¢žå¼ºç”Ÿæˆï¼‰ç³»ç»ŸåŒ…å«ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ï¼š

1. **Parserï¼ˆæ–‡æ¡£è§£æžå™¨ï¼‰**: æ”¯æŒTXTã€Markdownç­‰æ ¼å¼
2. **Chunkerï¼ˆæ–‡æœ¬åˆ†å—å™¨ï¼‰**: æ™ºèƒ½åˆ†å‰²æ–‡æœ¬ï¼Œä¿æŒå¥å­å®Œæ•´æ€§
3. **Embeddingï¼ˆå‘é‡åŒ–å™¨ï¼‰**: ä½¿ç”¨GLM embedding-2æ¨¡åž‹ç”Ÿæˆå‘é‡
4. **VectorStoreï¼ˆå‘é‡å­˜å‚¨ï¼‰**: å†…å­˜å‘é‡æ•°æ®åº“ï¼Œæ”¯æŒç›¸ä¼¼åº¦æœç´¢
5. **Retrieverï¼ˆæ£€ç´¢å™¨ï¼‰**: åŸºäºŽä½™å¼¦ç›¸ä¼¼åº¦çš„è¯­ä¹‰æ£€ç´¢

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

```bash
cd /Users/gongpengfei/Desktop/ClaudeCode/ai-agent-assistant
./bin/ai-agent-assistant
```

æœåŠ¡å°†å¯åŠ¨åœ¨ `http://localhost:8080`

---

## ðŸ“ APIæŽ¥å£è¯´æ˜Ž

### çŸ¥è¯†åº“ç®¡ç†æŽ¥å£

#### 1. æ·»åŠ æ–‡æœ¬çŸ¥è¯†

**æŽ¥å£**: `POST /api/v1/knowledge/add`

**è¯·æ±‚ä½“**:
```json
{
  "text": "äººå·¥æ™ºèƒ½æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯...",
  "source": "AIåŸºç¡€æ•™ç¨‹"
}
```

**ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8080/api/v1/knowledge/add \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Goè¯­è¨€æ˜¯è°·æ­Œå¼€å‘çš„é™æ€ç±»åž‹è¯­è¨€",
    "source": "ç¼–ç¨‹è¯­è¨€ä»‹ç»"
  }'
```

#### 2. ä»Žæ–‡æ¡£æ·»åŠ çŸ¥è¯†

**æŽ¥å£**: `POST /api/v1/knowledge/add/doc`

**è¯·æ±‚ä½“**:
```json
{
  "doc_path": "/path/to/document.txt"
}
```

**æ”¯æŒçš„æ ¼å¼**: .txt, .md

**ç¤ºä¾‹**:
```bash
# å…ˆåˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡æ¡£
echo "Goè¯­è¨€æ˜¯ä¸€ç§é™æ€ç±»åž‹ã€ç¼–è¯‘åž‹çš„ç¼–ç¨‹è¯­è¨€" > /tmp/test.txt

# æ·»åŠ åˆ°çŸ¥è¯†åº“
curl -X POST http://localhost:8080/api/v1/knowledge/add/doc \
  -H "Content-Type: application/json" \
  -d '{
    "doc_path": "/tmp/test.txt"
  }'
```

#### 3. æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡

**æŽ¥å£**: `GET /api/v1/knowledge/stats`

**ç¤ºä¾‹**:
```bash
curl http://localhost:8080/api/v1/knowledge/stats
```

**å“åº”**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "memory",
    "vector_count": 15,
    "dimension": 1024
  }
}
```

#### 4. æœç´¢çŸ¥è¯†åº“

**æŽ¥å£**: `POST /api/v1/knowledge/search`

**è¯·æ±‚ä½“**:
```json
{
  "query": "Goè¯­è¨€çš„ç‰¹ç‚¹",
  "top_k": 5
}
```

**ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8080/api/v1/knowledge/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Goè¯­è¨€",
    "top_k": 3
  }'
```

---

### RAGå¢žå¼ºå¯¹è¯æŽ¥å£

#### RAGå¯¹è¯

**æŽ¥å£**: `POST /api/v1/chat/rag`

**åŠŸèƒ½**: è‡ªåŠ¨ä»ŽçŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯ï¼Œå¢žå¼ºAIå›žç­”

**è¯·æ±‚ä½“**:
```json
{
  "session_id": "rag-test-001",
  "message": "Goè¯­è¨€æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ",
  "model": "glm"
}
```

**ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8080/api/v1/chat/rag \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "rag-test",
    "message": "Goè¯­è¨€æœ‰å“ªäº›ä¸»è¦ç‰¹ç‚¹ï¼Ÿ",
    "model": "glm"
  }'
```

---

## ðŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æµ‹è¯•1: æ·»åŠ çŸ¥è¯†å¹¶æŸ¥è¯¢

```bash
# 1. æ·»åŠ ç¬¬ä¸€æ¡çŸ¥è¯†
curl -X POST http://localhost:8080/api/v1/knowledge/add \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Goè¯­è¨€ç”±Googleå¼€å‘ï¼Œæ˜¯ä¸€ç§é™æ€ç±»åž‹ã€ç¼–è¯‘åž‹çš„ç¼–ç¨‹è¯­è¨€ã€‚Goè¯­è¨€çš„ç‰¹è‰²åŒ…æ‹¬å¹¶å‘ç¼–ç¨‹ã€åžƒåœ¾å›žæ”¶ã€å¿«é€Ÿç¼–è¯‘ç­‰ã€‚",
    "source": "Goè¯­è¨€ç®€ä»‹"
  }'

# 2. æ·»åŠ ç¬¬äºŒæ¡çŸ¥è¯†
curl -X POST http://localhost:8080/api/v1/knowledge/add \
  -H "Content-Type: application/json" \
  -d '{
    "text": "Pythonæ˜¯ä¸€ç§è§£é‡Šåž‹ã€é¢å‘å¯¹è±¡ã€åŠ¨æ€æ•°æ®ç±»åž‹çš„é«˜çº§ç¨‹åºè®¾è®¡è¯­è¨€ã€‚Pythonçš„è®¾è®¡å“²å­¦å¼ºè°ƒä»£ç çš„å¯è¯»æ€§å’Œç®€æ´çš„è¯­æ³•ã€‚",
    "source": "Pythonç®€ä»‹"
  }'

# 3. æŸ¥çœ‹çŸ¥è¯†åº“ç»Ÿè®¡
curl http://localhost:8080/api/v1/knowledge/stats

# 4. æœç´¢çŸ¥è¯†
curl -X POST http://localhost:8080/api/v1/knowledge/search \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Goè¯­è¨€çš„ç‰¹æ€§",
    "top_k": 3
  }'

# 5. ä½¿ç”¨RAGå¢žå¼ºå¯¹è¯
curl -X POST http://localhost:8080/api/v1/chat/rag \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test-rag",
    "message": "è¯·ä»‹ç»ä¸€ä¸‹Goè¯­è¨€çš„ä¸»è¦ç‰¹ç‚¹",
    "model": "glm"
  }'
```

### æµ‹è¯•2: ä»Žæ–‡æ¡£æ·»åŠ çŸ¥è¯†

```bash
# 1. åˆ›å»ºæµ‹è¯•æ–‡æ¡£
cat > /tmp/ai_knowledge.txt << 'EOF'
äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯è®¡ç®—æœºç§‘å­¦çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œè‡´åŠ›äºŽåˆ›å»ºèƒ½å¤Ÿæ‰§è¡Œé€šå¸¸éœ€è¦äººç±»æ™ºèƒ½çš„ä»»åŠ¡çš„ç³»ç»Ÿã€‚

æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªå­é¢†åŸŸï¼Œä½¿è®¡ç®—æœºèƒ½å¤Ÿä»Žæ•°æ®ä¸­å­¦ä¹ ï¼Œè€Œæ— éœ€æ˜Žç¡®ç¼–ç¨‹ã€‚

æ·±åº¦å­¦ä¹ æ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ä¸ªåˆ†æ”¯ï¼Œä½¿ç”¨å¤šå±‚ç¥žç»ç½‘ç»œæ¥å­¦ä¹ æ•°æ®çš„è¡¨ç¤ºã€‚
EOF

# 2. æ·»åŠ åˆ°çŸ¥è¯†åº“
curl -X POST http://localhost:8080/api/v1/knowledge/add/doc \
  -H "Content-Type: application/json" \
  -d '{
    "doc_path": "/tmp/ai_knowledge.txt"
  }'

# 3. ä½¿ç”¨RAGå¯¹è¯
curl -X POST http://localhost:8080/api/v1/chat/rag \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "test-ai",
    "message": "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿå®ƒå’Œæ·±åº¦å­¦ä¹ æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ",
    "model": "glm"
  }'
```

---

## ðŸ”§ æŠ€æœ¯ç»†èŠ‚

### æ–‡æœ¬åˆ†å—ç­–ç•¥

- **é»˜è®¤åˆ†å—å¤§å°**: 500å­—ç¬¦
- **é‡å å¤§å°**: 50å­—ç¬¦
- **åˆ†å—è¾¹ç•Œ**: ä¼˜å…ˆåœ¨å¥å­è¾¹ç•Œåˆ†å‰²ï¼ˆã€‚ï¼ï¼Ÿ.!?ï¼‰
- **ä¸­æ–‡æ”¯æŒ**: å®Œæ•´æ”¯æŒä¸­æ–‡åˆ†è¯

### å‘é‡åŒ–

- **æ¨¡åž‹**: GLM embedding-2
- **ç»´åº¦**: 1024
- **ç›¸ä¼¼åº¦ç®—æ³•**: ä½™å¼¦ç›¸ä¼¼åº¦
- **æ£€ç´¢é˜ˆå€¼**: 0.3ï¼ˆä½ŽäºŽæ­¤å€¼çš„ç»“æžœè¢«è¿‡æ»¤ï¼‰

### æ•°æ®å­˜å‚¨

- **ç±»åž‹**: å†…å­˜å‘é‡å­˜å‚¨
- **æŒä¹…åŒ–**: å½“å‰ç‰ˆæœ¬ä¸æŒä¹…åŒ–ï¼ˆé‡å¯åŽæ¸…ç©ºï¼‰
- **æ€§èƒ½**: é€‚åˆä¸­å°è§„æ¨¡çŸ¥è¯†åº“ï¼ˆ< 10000æ¡ï¼‰

---

## ðŸ“Š æ€§èƒ½å‚è€ƒ

| æ“ä½œ | è€—æ—¶ | è¯´æ˜Ž |
|------|------|------|
| æ·»åŠ 1KBæ–‡æœ¬ | ~2s | åŒ…å«åˆ†å—å’Œå‘é‡åŒ– |
| æ£€ç´¢top-3 | ~1s | å‘é‡æœç´¢+ç›¸ä¼¼åº¦è®¡ç®— |
| RAGå¯¹è¯ | ~3-5s | æ£€ç´¢+ç”Ÿæˆ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **APIé™åˆ¶**: GLM embedding APIæœ‰è°ƒç”¨é¢‘çŽ‡é™åˆ¶
2. **æ–‡æœ¬é•¿åº¦**: å•æ¬¡æ·»åŠ æ–‡æœ¬å»ºè®® < 10KB
3. **çŸ¥è¯†åº“å¤§å°**: å½“å‰ä¸ºå†…å­˜å­˜å‚¨ï¼Œé‡å¯åŽæ¸…ç©º
4. **ç›¸ä¼¼åº¦é˜ˆå€¼**: å¯æ ¹æ®å®žé™…æ•ˆæžœè°ƒæ•´`store.go`ä¸­çš„é˜ˆå€¼

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥æ”¹è¿›

- [ ] RedisæŒä¹…åŒ–å­˜å‚¨
- [ ] æ›´é«˜æ•ˆçš„å‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰
- [ ] æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼ï¼ˆPDF, Wordï¼‰
- [ ] å¢žé‡æ›´æ–°çŸ¥è¯†åº“
- [ ] çŸ¥è¯†åº“åŽ»é‡
- [ ] å¤šè·¯å¬å›žï¼ˆå…³é”®è¯+å‘é‡ï¼‰

---

## ðŸ“ž é—®é¢˜åé¦ˆ

å¦‚æžœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨
2. APIå¯†é’¥æ˜¯å¦é…ç½®æ­£ç¡®
3. ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹server.logæ—¥å¿—
